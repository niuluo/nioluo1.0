var UserMG={init:function(){$("#loading_div").modal("show");ManagementMenuActive.setActive(ManagementMenuEnum.UserGroup)}};UserMG.init();var userModule=angular.module("UserModule",["ManagementHttpModule"]);userModule.factory("UserFactory",[function(){return{DealUserRequest:function(b){var a={};if(b!=undefined&&b!=null){a={ID:b.ID,UserID:b.UserID,UserName:b.UserName,Password:b.Password,CreateTime:b.CreateTime,LoginState:b.LoginState,LastLoginTime:b.LastLoginTime,State:b.State,Gender:b.Gender,Email:b.Email,Birthday:b.Birthday,Mobile:b.Mobile,RoleID:b.RoleID,UserType:b.UserType}}return a}}}]);userModule.service("UserService",["$http","ResourceFactory","UserFactory","ManagementHttpService",function(e,a,b,c){var d={};d.initialize=function(){a.bindingDateTimeControl("em_birth","",new Date());$.formValidator.initConfig({validatorGroup:"2",mode:"AlertTip"});$("#jump_page").formValidator({validatorGroup:"2"}).functionValidator({fun:a.validateNumber})};d.calculatePages=function(l,h,m){var f=[];if(!m){if(h>l){return f}else{var k=Math.floor(l/5);var j=0;if(h>=(1+k*5)){for(var g=h;g<=l;g++){f.push(g)}}else{if(h+4>=l){for(var g=h;g<=l;g++){f.push(g)}}else{for(var g=h;g<=h+4;g++){f.push(g)}}}}}else{for(var g=h-5;g<h;g++){f.push(g)}}return f};d.getMappingUser=function(f){return b.DealUserRequest(f)};d.getUsers=function(f){$("#loading_div").modal("show");var g=f.searchRequest;try{c.userRequest(g,a.operateCode.get,function(i){$("#loading_div").modal("hide");$(".data_element").fadeIn();if(i.Header.StatusCode==0){f.userList=i.Body.UserList;f.totalCount=i.Body.Count;if(i.Body.Count<=g.Count){f.totalPages=1}else{f.totalPages=Math.ceil(i.Body.Count/g.Count)}if(f.isSwitchPages){f.currentFivePages=d.calculatePages(f.totalPages,1,false)}}else{GetErrormsg(i.Header.StatusCode);console.log(i)}},function(i){alert("服务器繁忙，请稍后再试！");console.log(i)})}catch(h){console.log(h)}};d.saveUser=function(f){var i=0;var g=b.DealUserRequest(f.currentUser);if(f.operateType==1){i=a.operateCode.update}else{i=a.operateCode.insert}try{c.userRequest(g,i,function(j){$("#new_user").modal("hide");if(j.Header.StatusCode==0){var k="";d.getUsers(f);if(f.operateType==1){k="用户信息更新成功！";if(g.State==1){k="成功删除用户【"+g.UserName+"】!"}}else{k="添加用户成功！"}alert(k)}else{var k="";if(f.operateType==1){k="用户信息更新失败，请稍后再试！"}else{k="添加用户失败，请稍后再试！"}alert(k);console.log(j)}},function(j){alert("系统繁忙，请稍后再试！");console.log(j)})}catch(h){console.log(h)}};return d}]);userModule.controller("UserController",["$scope","UserService","ResourceFactory",function(b,c,a){b.initialize=function(){b.userList=[];b.currentUser={};b.totalCount=0;b.totalPages=0;b.currentFivePages=[];b.currentPageNum=1;b.isSwitchPages=true;b.searchRequest={IsNeedRole:0,SearchType:0,Condition:"",Count:10,Index:1};if(screen.height<=768){b.pageSizeList=[{Type:1,Value:5},{Type:2,Value:10}]}else{b.pageSizeList=[{Type:1,Value:10},{Type:2,Value:15}]}b.genderList=[{Type:1,Name:"男"},{Type:2,Name:"女"}];c.getUsers(b);c.initialize()};b.resetUser=function(){b.currentUser.UserName="";b.currentUser.Password="";b.currentUser.Gender=0;b.currentUser.Mobile="";b.currentUser.Email="";b.currentUser.Birthday="";b.currentUser.RoleID=""};b.deleteUser=function(){b.operateType=1;b.currentUser.State=1};b.changePageSize=function(){b.isSwitchPages=true;c.getUsers(b)};b.prevPages=function(){if(b.currentFivePages[0]<=5){alert("对不起，已经在最前了！")}else{b.currentFivePages=c.calculatePages(b.totalPages,b.currentFivePages[0],true)}};b.nextPages=function(){var e=Math.floor(b.totalPages/5);var d=e*5+1;if(b.currentFivePages[0]>=d){alert("对不起，已经在最后了！")}else{b.currentFivePages=c.calculatePages(b.totalPages,b.currentFivePages[4]+1,false)}};b.isDisabled=function(){var e=Math.floor(b.totalPages/5);var d=e*b.searchRequest.Count+1;if(b.currentPageNum>=d){return true}else{return false}};b.switchToCurrentPage=function(d){$("#loading_div").modal("show");b.currentPageNum=d;b.isSwitchPages=false;b.searchRequest.Index=d;c.getUsers(b)};b.jumpToPage=function(){if(!$.formValidator.pageIsValid("2")){return}if(b.currentPageNum>b.totalPages){alert("对不起，没有当前的页数！")}else{b.searchRequest.Index=b.currentPageNum;c.getUsers(b)}};b.editUser=function(d){b.operateType=1;b.currentUser=c.getMappingUser(d)};b.addNewUser=function(){b.resetUser();b.currentUser.ID=0;b.currentUser.UserID="";b.currentUser.UserType=1;b.operateType=2;$("#new_user").modal("show")};b.switchPassword=function(){if($($("#new_user input[name='empPassword']")[0]).prop("type")=="password"){$($("#new_user input[name='empPassword']")[0]).prop("type","text")}else{$($("#new_user input[name='empPassword']")[0]).prop("type","password")}};b.saveUser=function(){c.saveUser(b)};b.getGenderName=function(d){switch(d){case 1:return"男";case 2:return"女";default:return""}};b.searchUsers=function(){if(b.searchRequest.Condition){if(a.checkFormat(b.searchRequest.Condition,DataTypeEnum.Number)){b.searchRequest.SearchType=2}else{b.searchRequest.SearchType=1}}c.getUsers(b)};b.deleteUser=function(d){if(confirm("确定要删除用户【"+d.UserName+"】吗？")){d.State=1;b.operateType=1;b.currentUser=d;c.saveUser(b)}};b.editUser=function(d){b.currentUser={ID:d.ID,UserID:d.UserID,UserName:d.UserName,Password:d.Password,CreateTime:d.CreateTime,LoginState:d.LoginState,LastLoginTime:d.LastLoginTime,State:d.State,Gender:d.Gender,Email:d.Email,Birthday:d.Birthday,Mobile:d.Mobile,RoleID:d.RoleID,UserType:d.UserType};b.operateType=1;$("#new_user").modal("show")};b.initialize()}]);angular.bootstrap($("#main-content"),["UserModule"]);