var RegisterMG={validatePhoneNum:function(){var b=$($("input[name='phoneNumber']")[0]).val();var a=/^[1]+[3,4,5,7,8]+\d{9}/;if(b!=undefined&&b!=""&&a.test(b)){return true}else{return"请输入有效的手机号！"}},validatePassword:function(){var b=$($("input[name='password']")[0]).val();var a=$($("input[name='confirmPassword']")[0]).val();if(b!=a){return"两次密码输入不一致！"}else{return true}},validateVerificationCode:function(){var a=$($("input[name='verificationCode']")[0]).val();if(a!=""&&a!=undefined){return true}else{return"请输入验证码！"}},validateInvitCode:function(){var a=$($("input[name='invitCode']")[0]).val();if(a!=""&&a!=undefined){return true}else{return"请输入邀请码！"}},validateClinicName:function(){var a=$($("input[name='clinicName']")[0]).val();if(a!=""&&a!=undefined){return true}else{return"请输入诊所名称！"}},validateClinicAddress:function(a){if(a!=""&&a!=undefined){return true}else{return"请输入地址！"}},validateContractor:function(){var a=$($("input[name='contractor']")[0]).val();if(a!=""&&a!=undefined){return true}else{return"请输入联系人名字！"}},validateContractPhone:function(){var a=$($("input[name='contractPhone']")[0]).val();var b=/^[1]+[3,4,5,8]+\d{9}/;if(a!=""&&a!=undefined&&b.test(a)){return true}else{return"请输入有效的手机号！"}},validateBookContract:function(){var c=$($("input[name='bookPhone']")[0]).val();var a=/^(\d{3,4}-)?\d{6,8}$/;var b=/^[1]+[3,4,5,8]+\d{9}/;if(c!=""&&c!=undefined&&(a.test(c)||b.test(c))){return true}else{return"请输入有效的电话！"}},init:function(){$.formValidator.initConfig({validatorGroup:"1",mode:"AlertTip"});$($("input[name='phoneNumber']")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:RegisterMG.validatePhoneNum});$($("input[name='confirmPassword']")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:RegisterMG.validatePassword});$($("input[name='verificationCode']")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:RegisterMG.validateVerificationCode});$($("input[name='clinicName']")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:RegisterMG.validateClinicName});$($("select[name='province']")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:RegisterMG.validateClinicAddress});$($("select[name='city']")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:RegisterMG.validateClinicAddress});$($("select[name='district']")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:RegisterMG.validateClinicAddress});$($("textarea[name='address']")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:RegisterMG.validateClinicAddress});$($("input[name='contractor']")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:RegisterMG.validateContractor});$($("input[name='contractPhone']")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:RegisterMG.validateContractPhone});$($("input[name='bookPhone']")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:RegisterMG.validateBookContract});$($("input[name='invitCode']")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:RegisterMG.validateInvitCode});$.formValidator.initConfig({validatorGroup:"2",mode:"AlertTip"});$($("input[name='phoneNumber']")[0]).formValidator({validatorGroup:"2"}).functionValidator({fun:RegisterMG.validatePhoneNum});$.formValidator.initConfig({validatorGroup:"3",mode:"AlertTip"});$($("input[name='confirmPassword']")[0]).formValidator({validatorGroup:"3"}).functionValidator({fun:RegisterMG.validatePassword})}};RegisterMG.init();var registerModule=angular.module("RegisterModule",["HttpModule","angularFileUpload"]);registerModule.factory("RegisterFactory",[function(){return{RegisterInfoRequest:{Mobile:"",TenantName:"",Password:"",Description:"",Authentication:"",Address:"",Contact:"",ContactPhone:"",Email:"",BookMobile:"",VerifyCode:"",InvitCode:""}}}]);registerModule.service("RegisterService",["$http","HttpService","ResourceFactory","$upload",function(e,b,a,c){var d={};d.getVerificationCode=function(g){var f=g.registerInfo.Mobile;if(!$.formValidator.pageIsValid("2")){return}try{var h={Mobile:f};b.verifyCodeRequest(h,function(j){if(j.Header.StatusCode==0){g.verificationResult=true}else{g.verificationResult=false;alert(GetErrormsg(j.Header.StatusCode))}},function(j){})}catch(i){console.log(i)}};d.getProvince=function(f){try{b.provinceRequest("",a.operateCode.get,function(h){if(h.Header.StatusCode==0){f.provinces=h.Body}},function(h){})}catch(g){console.log(g)}};d.getCity=function(f){if(f.registerInfo.Province==null){return}else{var g={ProvinceCode:f.registerInfo.Province.ProvinceCode}}try{b.cityRequest(g,a.operateCode.get,function(i){if(i.Header.StatusCode==0){f.citys=i.Body}},function(i){})}catch(h){console.log(h)}};d.getDistrict=function(f){if(f.registerInfo==null||f.registerInfo.City==null){return}else{var g={CityCode:f.registerInfo.City.CityCode}}try{b.districtRequest(g,a.operateCode.get,function(i){if(i.Header.StatusCode==0){f.districts=i.Body}},function(i){})}catch(h){console.log(h)}};d.registerInfo=function(f){try{b.tenantRequest(f,a.operateCode.insert,function(h){if(h.Header.StatusCode==0){alert("注册成功！");window.location.href="Login.html"}else{alert(GetErrormsg(h.Header.StatusCode))}},function(h){console.log(h)})}catch(g){console.log(g)}finally{}};d.uploadFiles=function(g,f){c.upload({url:WebServer.getUrl("UpLoadLogo"),file:g}).success(function(h){f.registerInfo.Logo=h.Body.Logo;f.LogoImage=FileURL+"Image/"+h.Body.Logo}).error(function(h){alert("上传文件失败")})};d.init=function(){a.module=0};return d}]);registerModule.controller("RegisterController",["$scope","RegisterService",function(a,b){a.registerInfo={};a.verificationResult=false;a.LogoImage="../images/logo.png";a.initialize=function(){var d="../Images/logo.ico";var c="纽罗口腔";$("title").html(c);$("#icon_link").prop("href",d);b.init()};a.showSecStep=function(){if(a.verificationResult&&(a.registerInfo.VerifyCode!=""&&a.registerInfo.VerifyCode!=null)&&(a.registerInfo.Password!=""&&a.registerInfo.Password!=null)&&(a.registerInfo.ConfirmPassword!=""&&a.registerInfo.ConfirmPassword!=null)&&(a.registerInfo.InvitCode!=""&&a.registerInfo.InvitCode!=null)){if($.formValidator.pageIsValid("3")){$("#sec_step").show();a.getProvince()}}};a.getProvince=function(){b.getProvince(a)};a.getCity=function(){b.getCity(a)};a.getDistrict=function(){b.getDistrict(a)};a.getVerificationCode=function(){if(!$.formValidator.pageIsValid("2")){return}var d=30;var c=setInterval(function(){if(d>0){d--;$("#btn_getVerificationCode").attr("disabled",true).html(d+"秒后")}else{clearInterval(c);$("#btn_getVerificationCode").removeAttr("disabled").html("再次获取验证码")}},1000);b.getVerificationCode(a)};a.submit=function(){if(!$.formValidator.pageIsValid("1")){return}a.registerInfo.Address=a.registerInfo.Province.ProvinceName+"省（市）"+a.registerInfo.City.CityName+"市"+a.registerInfo.District.DistrictName+a.registerInfo.detailAddress;var c={ID:0,TenantID:"",TenantName:a.registerInfo.TenantName,Password:a.registerInfo.Password,Description:a.registerInfo.Description,Authentication:a.registerInfo.Authentication,Address:a.registerInfo.Address,Contact:a.registerInfo.Contact,Mobile:a.registerInfo.Mobile,Email:a.registerInfo.Email,BookMobile:a.registerInfo.BookMobile,CreateTime:a.registerInfo.CreateTime,State:0,PasswordReminder:a.registerInfo.PasswordReminder,ContactPhone:a.registerInfo.ContactPhone,Logo:a.registerInfo.Logo,ExpireTime:a.registerInfo.ExpireTime,Province:a.registerInfo.Province.ProvinceName,City:a.registerInfo.City.CityName,District:a.registerInfo.District.DistrictName,VerifyCode:a.registerInfo.VerifyCode,InvitCode:a.registerInfo.InvitCode};b.registerInfo(c)};a.reset=function(){a.registerInfo.ClinicName="";a.registerInfo.Profile="";a.registerInfo.Authentication="";a.registerInfo.Address="";a.registerInfo.Contractor="";a.registerInfo.Province="";a.registerInfo.City="";a.registerInfo.District="";a.registerInfo.ContractPhone="";a.registerInfo.Email="";a.registerInfo.BookPhone=""};a.selectFile=function(){$("#selectFile").click()};a.changeFile=function(c){b.uploadFiles(c,a)}}]);