var PasswordMG={validatePhoneNum:function(){var b=$($("input[name='phoneNumber']")[0]).val();var a=/^[1]+[3,4,5,7,8]+\d{9}/;if(b!=undefined&&b!=""&&a.test(b)){return true}else{return"请输入有效的手机号！"}},validateVerificationCode:function(){var a=$($("input[name='verificationCode']")[0]).val();if(a!=""&&a!=undefined){return true}else{return"请输入验证码！"}},validateInvitCode:function(){var a=$($("input[name='invitCode']")[0]).val();if(a!=""&&a!=undefined){return true}else{return"请输入短信验证码！"}},validatePassword:function(a){if(a==""||a==null){return"请输入密码"}else{return true}},init:function(){$.formValidator.initConfig({validatorGroup:"1",mode:"AlertTip"});$($("#pwd_form input[name='phoneNumber']")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:PasswordMG.validatePhoneNum});$($("#pwd_form input[name='verificationCode']")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:PasswordMG.validateVerificationCode});$($("#pwd_form input[name='invitCode']")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:PasswordMG.validateInvitCode});$($("#pwd_form input[name='password']")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:PasswordMG.validatePassword});$.formValidator.initConfig({validatorGroup:"2",mode:"AlertTip"});$($("#pwd_form input[name='phoneNumber']")[0]).formValidator({validatorGroup:"2"}).functionValidator({fun:PasswordMG.validatePhoneNum})}};PasswordMG.init();var passwordModule=angular.module("PasswordModule",["HttpModule"]);passwordModule.factory("PasswordFactory",[function(){return{PasswordInfoRequest:{Mobile:"",Password:"",VerifyCode:"",UserType:1}}}]);passwordModule.service("PasswordService",["HttpService","ResourceFactory",function(c,a){var b={};b.getVerifiCode=function(f){var d=f.passwordInfo.Mobile;try{var g={Mobile:d};c.sendSMSForPasswordRequest(g,function(e){if(e.Header.StatusCode==0){f.verificationResult=true}else{f.verificationResult=false;alert(GetErrormsg(e.Header.StatusCode))}},function(e){console.log(e)})}catch(h){console.log(h)}};b.passwordInfo=function(d){try{c.modifyPasswordRequest(d,a.operateCode.update,function(e){if(e.Header.StatusCode==0){b.alert("密码重置成功！");window.location.href="Login.html"}else{b.alert(GetErrormsg(e.Header.StatusCode))}},function(e){console.log(e)})}catch(f){console.log(f)}finally{}};b.alert=function(d){a.MsgBox.Alert("消息",d)};b.init=function(){a.module=0};return b}]);passwordModule.controller("PasswordController",["$scope","PasswordService",function(a,b){a.passwordInfo={};a.verificationResult=false;a.getVerifiCode=function(){if(!$.formValidator.pageIsValid("2")){return}var d=30;var c=setInterval(function(){if(d>0){d--;$("#btn_getVerifiCode").attr("disabled",true).html(d+"秒后")}else{clearInterval(c);$("#btn_getVerifiCode").removeAttr("disabled").html("再次获取验证码")}},1000);b.getVerifiCode(a)};a.createCode=function(){var f="";var e=4;var c=$("#checkCode")[0];var g=new Array(0,1,2,3,4,5,6,7,8,9,"a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z");for(var d=0;d<e;d++){var h=Math.floor(Math.random()*52);f+=g[h]}if(c){c.className="code";c.innerHTML=f}};a.createCode();a.submit=function(){if(!$.formValidator.pageIsValid("1")){return}var d=$("#inputCode").val();if(!d){b.alert("请输入验证码！");a.createCode();return}else{if(d!=checkCode.innerHTML){b.alert("验证码输入有误！请区分大小写");a.createCode();return}}var c={Password:a.passwordInfo.Password,Mobile:a.passwordInfo.Mobile,VerifyCode:a.passwordInfo.VerifyCode,UserType:1};b.passwordInfo(c)}}]);