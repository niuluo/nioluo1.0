var DataStatisticMG={init:function(){$("#loading_div").modal("show");MenuActive.setActive(MenuEnum.DataStatic);CommonFun.bindingDateControl("patientFromStartDate","","",false);CommonFun.bindingDateControl("patientFromEndDate","","",false);CommonFun.bindingDateControl("newPatientStartDate","","",false);CommonFun.bindingDateControl("newPatientEndDate","","",false);CommonFun.bindingDateControl("doctorCostStartDate","","",false);CommonFun.bindingDateControl("doctorCostEndDate","","",false);CommonFun.bindingDateControl("appointStartDate","","",false);CommonFun.bindingDateControl("appointEndDate","","",false);CommonFun.bindingDateControl("reportBeginDate","","",false);CommonFun.bindingDateControl("reportEndDate","","",false);CommonFun.bindingDateControl("daily_date","","",false,"month");$("#reportStartDate").datetimepicker({format:"yyyy-mm",language:"en",startView:"year",minView:"year",maxView:"decade",inputMask:true});$.formValidator.initConfig({validatorGroup:"1",mode:"AlertTip"});$($("#patientFromStartDate")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:DataStatisticMG.validateDate});$($("#patientFromEndDate")[0]).formValidator({validatorGroup:"1"}).functionValidator({fun:DataStatisticMG.validateDate});$.formValidator.initConfig({validatorGroup:"2",mode:"AlertTip"});$($("#newPatientStartDate")[0]).formValidator({validatorGroup:"2"}).functionValidator({fun:DataStatisticMG.validateDate});$($("#newPatientEndDate")[0]).formValidator({validatorGroup:"2"}).functionValidator({fun:DataStatisticMG.validateDate});$.formValidator.initConfig({validatorGroup:"3",mode:"AlertTip"});$($("#doctorCostStartDate")[0]).formValidator({validatorGroup:"3"}).functionValidator({fun:DataStatisticMG.validateDate});$($("#doctorCostEndDate")[0]).formValidator({validatorGroup:"3"}).functionValidator({fun:DataStatisticMG.validateDate});$.formValidator.initConfig({validatorGroup:"4",mode:"AlertTip"});$("#appointStartDate").formValidator({validatorGroup:"4"}).functionValidator({fun:DataStatisticMG.validateDate});$("#appointEndDate").formValidator({validatorGroup:"4"}).functionValidator({fun:DataStatisticMG.validateDate});$.formValidator.initConfig({validatorGroup:"5",mode:"AlertTip"});$("#reportBeginDate").formValidator({validatorGroup:"5"}).functionValidator({fun:DataStatisticMG.validateDate});$("#reportEndDate").formValidator({validatorGroup:"5"}).functionValidator({fun:DataStatisticMG.validateDate})},validateDate:function(b,a){if(!CommonFun.checkFormat(b,DataTypeEnum.DateFormat)){return"日期无效，请重新输入"}else{return true}}};DataStatisticMG.init();var baseColors=["#483D8B","#cbab4f","#76a871","#a56f8f","#c12c44","#9f7961","#6f83a5","#32bdbc","#d75a5e","#4169E1","#87CEEB","#8470FF","#828282","#7EC0EE","#7CFC00","#7A8B8B","#76EE00","#7171C6","#6E7B8B","#6B8E23","#698B22"];var showWeekDays=16;var showMonthDays=85;var dataStaticModule=angular.module("DataStaticModule",["HttpModule","PermissionModule"]);dataStaticModule.service("DataStaticService",["HttpService","ResourceFactory","PermissionFactory",function(d,b,a){var c={};c.searchPatientFrom=function(g){var f={TenantID:g.currentUser.Body.Tenant.TenantID};if(g.searchData.patientFrom.StartDate!=null&&g.searchData.patientFrom.StartDate!=""){f.BeginTime=g.searchData.patientFrom.StartDate;f.EndTime=g.searchData.patientFrom.EndDate;g.searchData.patientFrom.All=false;f.IsAll=0}else{g.searchData.patientFrom.All=true;f.IsAll=1}c.getPatientFromList(f,g)};c.getPatientFromList=function(g,f){d.patientSourceReportRequest(g,b.operateCode.get,function(h){$(".body_hide").css("opacity","1");$("#loading_div").modal("hide");if(h.Header.StatusCode==0){f.patientSourceData=null;if(h.Body==null||h.Body.PatientSourceList==null||h.Body.PatientSourceList.length==0){f.showPatientSourcePie=false;f.showPatientSourceColumn=false;f.noPatientSourceData=true}else{f.noPatientSourceData=false;f.showPatientSourceColumn=true;f.showPatientSourcePie=false;f.patientSourceData=h.Body;f.showPatientFromColumnChart()}}else{c.alert(GetErrormsg(h.Header.StatusCode));f.noPatientSourceData=true;f.showPatientSourcePie=false;f.showPatientSourceColumn=false}},function(h){console.log(h)})};c.createPatientFromSourceOfPie=function(m,n){var h=[];for(var k=0;k<m.PatientSourceList.length;k++){var o=m.PatientSourceList[k];h.push({key:o.PatientSourceID,name:o.Name,color:k<baseColors.length?baseColors[k]:baseColors[0],value:0})}if(m.ReportList==null){m.ReportList=[]}for(var k=0;k<m.ReportList.length;k++){var o=m.ReportList[k];for(var f=0;f<h.length;f++){var p=h[f];if(p.key==o.PatientSourceID){p.value=p.value+o.Quantity;break}}}var l="患者来源";if(n.searchData.patientFrom.All){l+="(全部数据)"}else{l+="("+n.searchData.patientFrom.StartDate+"到"+n.searchData.patientFrom.EndDate+")"}var g={data:h,divId:"canvasDivOfPatientSourcePie",header:l};return g};c.createPatientFromSourceOfColumn=function(x,q){var p=[];var z=[];var v=0;var f=new Date(q.searchData.patientFrom.EndDate);var l=new Date(q.searchData.patientFrom.StartDate);for(var u=0;u<x.PatientSourceList.length;u++){var w=x.PatientSourceList[u];p.push({key:w.PatientSourceID,name:w.Name,color:u<baseColors.length?baseColors[u]:baseColors[0],value:[]})}if(q.searchData.patientFrom.All){z.push(["全部数据"])}else{if(!q.searchData.patientFrom.All){var h=new Date(f.getFullYear(),f.getMonth(),1);var y=new Date(l.getFullYear(),l.getMonth(),1);var o=false;while(!o){var C=c.getFormatDate(y,2);z.push(C);y.setMonth(y.getMonth()+1);if(h<y){o=true}}}}if(x.ReportList==null){x.ReportList=[]}for(var s=0;s<z.length;s++){var g=z[s];for(var u=0;u<p.length;u++){p[u].value.push(0)}for(var r=0;r<x.ReportList.length;r++){var w=x.ReportList[r];var n=w.Year.toString();var A=w.Month.toString();if(A.length==1){A="0"+A}var C=n+"-"+A;for(var u=0;u<p.length;u++){var k=p[u];if((z.length==1&&k.key==w.PatientSourceID)||(k.key==w.PatientSourceID&&g==C)){k.value[s]=k.value[s]+w.Quantity;if(k.value[s]>v){v=k.value[s]}break}}}}v=v+10;var t="患者来源";if(q.searchData.patientFrom.All){t+="(全部数据)"}else{t+="("+q.searchData.patientFrom.StartDate+"到"+q.searchData.patientFrom.EndDate+")"}var B={data:p,divId:"canvasDivOfPatientSourceColumn",labels:z,header:t,end:v,space:Math.round(v/10),leftText:"患者人数（人）"};return B};c.setNewPatientStartTime=function(g,f){if(g.searchData.newPatient.EndDate==null){return}var h=new Date(g.searchData.newPatient.EndDate);h.setDate(h.getDate()+f);g.searchData.newPatient.StartDate=c.getFormatDate(h,0)};c.searchTreats=function(f){$("#loading_div").modal("show");var g={TenantID:f.currentUser.Body.Tenant.TenantID,BeginTime:f.searchData.newPatient.StartDate,EndTime:f.searchData.newPatient.EndDate};try{d.reportTreatStatisticsRequest(g,b.operateCode.get,function(i){$("#loading_div").modal("hide");if(i.Header.StatusCode==0){if(i.Body==null){f.showNewPatientColumn=false;f.showNewPatientLine=false;f.noNewPatientData=true}else{f.noNewPatientData=false;f.showNewPatientColumn=true;f.showNewPatientLine=false}f.TreatsData=i.Body;f.showNewPatientColumnChart()}else{f.showNewPatientColumn=false;f.showNewPatientLine=false;f.noNewPatientData=true;c.alert(GetErrormsg(i.Header.StatusCode));console.log(i)}},function(i){c.alert("系统繁忙，请稍候再试！");console.log(i)})}catch(h){console.log(h)}};c.createTreatOfColumn=function(w,p){var f=new Date(p.searchData.newPatient.EndDate);var l=new Date(p.searchData.newPatient.StartDate);var E=f-l;var g=parseInt(E/(1000*60*60*24))+1;var o=[];var u=0;if(g<showWeekDays){for(var t=0;t<g;t++){var y=new Date(p.searchData.newPatient.StartDate);y.setDate(y.getDate()+t);o.push({key:c.getFormatDate(y,0),name:c.getFormatDate(y,1),color:baseColors[0],value:0})}for(var t=0;t<w.length;t++){var v=w[t];var y=new Date(v.Year.toString()+"-"+v.Month.toString()+"-"+v.Day.toString());var D=c.getFormatDate(y,0);for(var r=0;r<o.length;r++){var k=o[r];if(k.key==D){k.value=k.value+v.Quantity;if(k.value>u){u=k.value}break}}}}else{if(g>showMonthDays){var h=new Date(f.getFullYear(),f.getMonth(),1);var x=new Date(l.getFullYear(),l.getMonth(),1);var n=false;while(!n){var D=c.getFormatDate(x,2);o.push({key:D,name:D,color:baseColors[0],value:0});x.setMonth(x.getMonth()+1);if(h<x){n=true}}for(var t=0;t<w.length;t++){var v=w[t];var m=v.Year.toString();var z=v.Month.toString();if(z.length==1){z="0"+z}var D=m+"-"+z;for(var r=0;r<o.length;r++){var k=o[r];if(k.key==D){k.value=k.value+v.Quantity;if(k.value>u){u=k.value}break}}}}else{var A=e(l);var n=false;while(!n){var D=c.getFormatDate(A.weekStartDate,0)+"-"+c.getFormatDate(A.weekEndDate,0);var C=c.getFormatDate(A.weekStartDate,1)+"至"+c.getFormatDate(A.weekEndDate,1);o.push({key:D,name:C,color:baseColors[0],value:0});l=A.weekStartDate;l.setDate(l.getDate()+7);A=e(l);if(f<l){n=true}}for(var t=0;t<w.length;t++){var v=w[t];var y=new Date(v.Year,v.Month-1,v.Day);var q=e(y);var D=c.getFormatDate(q.weekStartDate,0)+"-"+c.getFormatDate(q.weekEndDate,0);for(var r=0;r<o.length;r++){var k=o[r];if(k.key==D){k.value=k.value+v.Quantity;if(k.value>u){u=k.value}break}}}}}u=u+10;var s="就诊人数统计";s+="("+p.searchData.newPatient.StartDate+"到"+p.searchData.newPatient.EndDate+")";var B={data:o,divId:"canvasDivOfNewPatientColumn",header:s,end:u,space:Math.round(u/10),leftText:"就诊人数（人）"};return B};c.createTreatOfLine=function(w,q){var f=new Date(q.searchData.newPatient.EndDate);var m=new Date(q.searchData.newPatient.StartDate);var D=f-m;var k=parseInt(D/(1000*60*60*24))+1;var p=[];p.push({name:"患者数量",color:baseColors[0],value:[],line_width:3});var y=[];var o=[];var u=0;if(k<showWeekDays){for(var t=0;t<k;t++){var z=new Date(q.searchData.newPatient.StartDate);z.setDate(z.getDate()+t);y.push(c.getFormatDate(z,1));p[0].value.push(0);o.push(z)}for(var t=0;t<w.length;t++){var v=w[t];var z=new Date(v.Year.toString()+"-"+v.Month.toString()+"-"+v.Day.toString());for(var r=0;r<o.length;r++){var C=o[r];if(z<=C){p[0].value[r]=p[0].value[r]+v.Quantity}}}}else{if(k>showMonthDays){var l=new Date(f.getFullYear(),f.getMonth(),1);var x=new Date(m.getFullYear(),m.getMonth(),1);var n=false;while(!n){o.push(new Date(x.getFullYear(),x.getMonth(),x.getDate()));y.push(c.getFormatDate(x,2));p[0].value.push(0);x.setMonth(x.getMonth()+1);if(l<x){n=true}}for(var t=0;t<w.length;t++){var v=w[t];var z=new Date(v.Year,v.Month-1,1);for(var r=0;r<o.length;r++){var C=o[r];if(z<=C){p[0].value[r]=p[0].value[r]+v.Quantity}}}}else{var A=e(m);var n=false;while(!n){var h=new Date(A.weekStartDate.getFullYear(),A.weekStartDate.getMonth(),A.weekStartDate.getDate());var g=new Date(A.weekEndDate.getFullYear(),A.weekEndDate.getMonth(),A.weekEndDate.getDate());o.push({start:h,end:g});y.push(c.getFormatDate(A.weekStartDate,1)+"至"+c.getFormatDate(A.weekEndDate,1));p[0].value.push(0);m=A.weekStartDate;m.setDate(m.getDate()+7);A=e(m);if(f<m){n=true}}for(var t=0;t<w.length;t++){var v=w[t];var z=new Date(v.Year,v.Month-1,v.Day);for(var r=0;r<o.length;r++){var C=o[r];if(z<=C.end){p[0].value[r]=p[0].value[r]+v.Quantity}}}}}var s="就诊人数";s+="("+q.searchData.newPatient.StartDate+"到"+q.searchData.newPatient.EndDate+")";p[0].name=c.changeNameForLine(p[0]);var B={data:p,divId:"canvasDivOfNewPatientLine",header:s,label:y};B.listeners={parseText:function(I,E,H,J,F,G){if(E==""){return J}var j=JSON.parse(E);return("就诊人数:"+H).toString()}};return B};c.changeNameForLine=function(f){var g="[";for(var h=f.value.length-1;h>=0;h--){var k=f.value[h];var j=0;if(h>0){j=f.value[h-1]}g=g+(k-j).toString()+","}g=g.substr(0,g.length-1);g=g+"]";return g};c.setDoctorCostStartTime=function(g,f){if(g.searchData.costType.EndDate==null){return}var h=new Date(g.searchData.costType.EndDate);h.setDate(h.getDate()+f);g.searchData.costType.StartDate=c.getFormatDate(h,0)};c.searchCostData=function(f){$("#loading_div").modal("show");var g={TenantID:f.currentUser.Body.Tenant.TenantID,BeginTime:f.searchData.costType.StartDate,EndTime:f.searchData.costType.EndDate};try{d.reportCostTypeRequest(g,b.operateCode.get,function(i){$("#loading_div").modal("hide");if(i.Header.StatusCode==0){f.costData=i.Body;f.switchCostChart(1)}else{f.showCostColumn=false;c.alert(GetErrormsg(i.Header.StatusCode))}},function(i){c.alert("系统繁忙，请稍后再试！");console.log(i)})}catch(h){console.log(h)}};c.createCostForColumn=function(x,q){var p=[];var z=[];var v=0;var f=new Date(q.searchData.costType.EndDate);var l=new Date(q.searchData.costType.StartDate);if(x!=null&&x.CategoryList!=null&&x.CategoryList.length>0){for(var u=0;u<x.CategoryList.length;u++){var w=x.CategoryList[u];p.push({key:w.CategoryID,name:w.Name,color:u<baseColors.length?baseColors[u]:baseColors[0],value:[]})}}var h=new Date(f.getFullYear(),f.getMonth(),1);var y=new Date(l.getFullYear(),l.getMonth(),1);var o=false;while(!o){var C=c.getFormatDate(y,2);z.push(C);y.setMonth(y.getMonth()+1);if(h<y){o=true}}for(var s=0;s<z.length;s++){var g=z[s];for(var u=0;u<p.length;u++){p[u].value.push(0)}for(var r=0;r<x.ReportList.length;r++){var w=x.ReportList[r];var n=w.Year.toString();var A=w.Month.toString();if(A.length==1){A="0"+A}var C=n+"-"+A;for(var u=0;u<p.length;u++){var k=p[u];if(k.key==w.CategoryID&&g==C){k.value[s]=w.Price;if(k.value[s]>v){v=k.value[s]}break}}}}v=v+20;var t="已结算账单金额统计";t+="("+q.searchData.costType.StartDate+"到"+q.searchData.costType.EndDate+")";var B={data:p,divId:"canvasDivOfDoctorCost",labels:z,header:t,end:v,space:Math.round(v/10),leftText:"收费金额（元）"};return B};c.createCostForPie=function(m,n){var h=[];for(var k=0;k<m.CategoryList.length;k++){var o=m.CategoryList[k];h.push({key:o.CategoryID,name:o.Name,color:k<baseColors.length?baseColors[k]:baseColors[0],value:0})}if(m.ReportList==null){m.ReportList=[]}for(var k=0;k<m.ReportList.length;k++){var o=m.ReportList[k];for(var f=0;f<h.length;f++){var p=h[f];if(p.key==o.CategoryID){p.value=p.value+o.Price;break}}}var l="收费统计";l+="("+n.searchData.costType.StartDate+"到"+n.searchData.costType.EndDate+")";var g={data:h,divId:"canvasDivOfCostPie",header:l};return g};c.setAppointStartTime=function(g,f){if(g.searchData.appoint.EndDate==null){return}var h=new Date(g.searchData.appoint.EndDate);h.setDate(h.getDate()+f);g.searchData.appoint.StartDate=c.getFormatDate(h,0)};c.searchAppointItemsData=function(f){$("#loading_div").modal("show");var g={TenantID:f.currentUser.Body.Tenant.TenantID,BeginTime:f.searchData.appoint.StartDate,EndTime:f.searchData.appoint.EndDate};try{d.reportAppointItemsRequest(g,b.operateCode.get,function(i){$("#loading_div").modal("hide");if(i.Header.StatusCode==0){f.appointData=i.Body;f.switchAppointChart(1)}else{f.showAppointLine=false;c.alert(GetErrormsg(i.Header.StatusCode))}},function(i){console.log(i)})}catch(h){console.log(h)}};c.createAppointForColumn=function(x,q){var p=[];var z=[];var v=0;var f=new Date(q.searchData.appoint.EndDate);var l=new Date(q.searchData.appoint.StartDate);for(var u=0;u<x.CategoryList.length;u++){var w=x.CategoryList[u];p.push({key:w.CategoryID,name:w.Name,color:u<baseColors.length?baseColors[u]:baseColors[0],value:[]})}var h=new Date(f.getFullYear(),f.getMonth(),1);var y=new Date(l.getFullYear(),l.getMonth(),1);var o=false;while(!o){var C=c.getFormatDate(y,2);z.push(C);y.setMonth(y.getMonth()+1);if(h<y){o=true}}if(x.ReportList==null){x.ReportList=[]}for(var s=0;s<z.length;s++){var g=z[s];for(var u=0;u<p.length;u++){p[u].value.push(0)}for(var r=0;r<x.ReportList.length;r++){var w=x.ReportList[r];var n=w.Year.toString();var A=w.Month.toString();if(A.length==1){A="0"+A}var C=n+"-"+A;for(var u=0;u<p.length;u++){var k=p[u];if(k.key==w.CategoryID&&g==C){k.value[s]=k.value[s]+w.Quantity;if(k.value[s]>v){v=k.value[s]}break}}}}v=v+20;var t="预约统计";t+="("+q.searchData.appoint.StartDate+"到"+q.searchData.appoint.EndDate+")";var B={data:p,divId:"canvasDivOfAppoint",labels:z,header:t,end:v,space:Math.round(v/10),leftText:"预约人数（人）"};return B};c.createAppointForPie=function(m,n){var h=[];for(var k=0;k<m.CategoryList.length;k++){var o=m.CategoryList[k];h.push({key:o.CategoryID,name:o.Name,color:k<baseColors.length?baseColors[k]:baseColors[0],value:0})}if(m.ReportList==null){m.ReportList=[]}for(var k=0;k<m.ReportList.length;k++){var o=m.ReportList[k];for(var f=0;f<h.length;f++){var p=h[f];if(p.key==o.CategoryID){p.value=p.value+o.Quantity;break}}}var l="预约统计";l+="("+n.searchData.appoint.StartDate+"到"+n.searchData.appoint.EndDate+")";var g={data:h,divId:"canvasDivOfAppointPie",header:l};return g};c.createColumnMultiChart=function(g){var f=new iChart.ColumnMulti3D({render:g.divId,data:g.data,labels:g.labels,title:g.header,width:950,height:500,animation:true,animation_duration:1000,shadow:true,shadow_color:"#c7c7c7",coordinate:{scale:[{position:"left",start_scale:0,end_scale:g.end,scale_space:g.space,listeners:{}}]},legend:{enable:true,align:"right",valign:"middle"},tip:{enable:true}});f.plugin(new iChart.Custom({drawFn:function(){var i=f.getCoordinate(),h=i.get("originx"),j=i.get("originy");f.target.textAlign("start").textBaseline("bottom").textFont("600 11px Verdana").fillText(g.leftText,h-40,j-28,false,"#6d869f")}}));f.draw()};c.createColumn3DChart=function(g){var f=new iChart.Column3D({render:g.divId,data:g.data,title:g.header,width:950,height:500,animation:true,animation_duration:1000,shadow:true,shadow_color:"#c7c7c7",coordinate:{scale:[{position:"left",start_scale:0,end_scale:g.end,scale_space:g.space,listeners:{}}]},tip:{enable:true}});f.plugin(new iChart.Custom({drawFn:function(){var i=f.getCoordinate(),h=i.get("originx"),j=i.get("originy");f.target.textAlign("start").textBaseline("bottom").textFont("600 11px Verdana").fillText(g.leftText,h-40,j-28,false,"#6d869f")}}));f.draw()};c.createPieChart=function(f){new iChart.Pie3D({render:f.divId,data:f.data,title:f.header,legend:{enable:true},showpercent:true,animation:true,animation_duration:1000,decimalsnum:2,width:950,height:500,radius:140}).draw()};c.createLineChart=function(f){new iChart.LineBasic2D({render:f.divId,data:f.data,title:f.header,width:950,height:500,animation:true,animation_duration:1000,coordinate:{height:"90%",background_color:"#f6f9fa"},sub_option:{hollow_inside:false,point_size:16,label:false},labels:f.label,tip:{enable:true,shadow:true,listeners:f.listeners},crosshair:{enable:true,line_color:"#62bce9"}}).draw()};c.getFormatDate=function(g,i){if(g==null){return""}var h=g.getFullYear();var j=(g.getMonth()+1).toString();var f=g.getDate().toString();if(j.length==1){j="0"+j}if(f.length==1){f="0"+f}if(i==0){return h+"-"+j+"-"+f}else{if(i==1){return j+"-"+f}else{if(i==2){return h+"-"+j}else{return""}}}};var e=function(i){var j=i.getFullYear();var k=i.getMonth();var h=i.getDate();var l=i.getDay()-1;var f=new Date(j,k,h-l);var g=new Date(j,k,h+(6-l));return{weekStartDate:f,weekEndDate:g}};c.exportPatientFrom=function(h){var i=WebServer.getUrl("PatientSourceExport");var j=h.searchData.patientFrom.StartDate==null?"":h.searchData.patientFrom.StartDate;var g=h.searchData.patientFrom.EndDate==null?"":h.searchData.patientFrom.EndDate;var f=h.searchData.patientFrom.All?1:0;i=i+"?TenantID="+h.currentUser.Body.Tenant.TenantID+"&Token="+h.currentUser.Header.Token+"&BeginTime="+j+"&EndTime="+g+"&IsAll="+f+"&Module="+b.module;window.location.href=i};c.exportTreat=function(g){var h=WebServer.getUrl("TreatExport");var i=g.searchData.newPatient.StartDate==null?"":g.searchData.newPatient.StartDate;var f=g.searchData.newPatient.EndDate==null?"":g.searchData.newPatient.EndDate;h=h+"?TenantID="+g.currentUser.Body.Tenant.TenantID+"&Token="+g.currentUser.Header.Token+"&BeginTime="+i+"&EndTime="+f+"&Module="+b.module;window.location.href=h};c.exportCostType=function(g){var h=WebServer.getUrl("CostExport");var i=g.searchData.costType.StartDate==null?"":g.searchData.costType.StartDate;var f=g.searchData.costType.EndDate==null?"":g.searchData.costType.EndDate;h=h+"?TenantID="+g.currentUser.Body.Tenant.TenantID+"&Token="+g.currentUser.Header.Token+"&BeginTime="+i+"&EndTime="+f+"&Module="+b.module;window.location.href=h};c.exportAppoint=function(g){var h=WebServer.getUrl("AppointExport");var i=g.searchData.appoint.StartDate==null?"":g.searchData.appoint.StartDate;var f=g.searchData.appoint.EndDate==null?"":g.searchData.appoint.EndDate;h=h+"?TenantID="+g.currentUser.Body.Tenant.TenantID+"&Token="+g.currentUser.Header.Token+"&BeginTime="+i+"&EndTime="+f+"&Module="+b.module;window.location.href=h};c.exportReport=function(f){var g=WebServer.getUrl("DentalClinicExport");var i=f.searchData.report.DateTime==null?"":f.searchData.report.DateTime;var h=f.searchData.report.DateType==null?0:f.searchData.report.DateType;g=g+"?TenantID="+f.currentUser.Body.Tenant.TenantID+"&Token="+f.currentUser.Header.Token+"&Date="+i+"&DateType="+h+"&Module="+b.module;window.location.href=g};c.exportEmployeeReport=function(g){var h=WebServer.getUrl("EmployeeExport");var i=g.searchData.report.BeginDate==null?"":g.searchData.report.BeginDate;var f=g.searchData.report.EndDate==null?0:g.searchData.report.EndDate;h=h+"?TenantID="+g.currentUser.Body.Tenant.TenantID+"&Token="+g.currentUser.Header.Token+"&BeginTime="+i+"&EndTime="+f+"&Module="+b.module;window.location.href=h};c.searchReportData=function(f){$("#loading_div").modal("show");var g={TenantID:f.currentUser.Body.Tenant.TenantID,DateType:f.searchData.report.DateType,Date:f.searchData.report.DateTime};try{d.dentalClinicRequest(g,b.operateCode.get,function(i){$("#loading_div").modal("hide");if(i.Header.StatusCode==0){f.reportData=i.Body;f.switchReport(g.DateType)}else{c.alert(GetErrormsg(i.Header.StatusCode));console.log(i)}},function(i){c.alert("系统繁忙，请稍后再试！");console.log(i)})}catch(h){console.log(h)}};c.searchEmployeeReportData=function(f){$("#loading_div").modal("show");var g={TenantID:f.currentUser.Body.Tenant.TenantID,BeginTime:f.searchData.report.BeginDate,EndTime:f.searchData.report.EndDate};try{d.doctorCostReportRequest(g,b.operateCode.get,function(k){$("#loading_div").modal("hide");if(k.Header.StatusCode==0){f.reportData=k.Body;if(f.reportData!=null&&f.reportData.UserList!=null&&f.reportData.UserList.length>0){for(var m=0;m<f.reportData.UserList.length;m++){f.reportData.UserList[m].TotalPrice=0;for(var l=0;l<f.reportData.ReportList.length;l++){if(f.reportData.UserList[m].UserID==f.reportData.ReportList[l].DoctorID){f.reportData.UserList[m].TotalPrice=f.reportData.UserList[m].TotalPrice+f.reportData.ReportList[l].Price}}}}f.switchReport(f.searchData.report.DateType)}else{c.alert(GetErrormsg(k.Header.StatusCode));console.log(k)}},function(i){c.alert("系统繁忙，请稍后再试！");console.log(i)})}catch(h){console.log(h)}};c.initialize=function(){b.module=MenuEnum.DataStatic};c.isWithOperatePermission=function(f){var g=b.Auths[f];return a.isWithOperatePermission(MenuEnum.DataStatic,g)};c.confirm=function(g,h,f){b.MsgBox.Confirm("温馨提示",g,h,f)};c.alert=function(f){b.MsgBox.Alert("消息",f)};return c}]);dataStaticModule.controller("DataStaticController",["DataStaticService","$scope",function(b,a){a.currentUser=CommonFun.getDataFromSession("CurrentUser");a.reportTypes=[{Type:1,Value:"年报"},{Type:2,Value:"月报"},{Type:3,Value:"日报"},{Type:4,Value:"员工报表"}];a.initialize=function(){b.initialize();a.searchData={patientFrom:{},newPatient:{},costType:{},appoint:{},report:{}};var c=new Date();a.searchData.report.DateType=1;a.searchData.report.DateTime=b.getFormatDate(c,2);a.searchData.report.EndDate=b.getFormatDate(c,0);a.searchData.newPatient.EndDate=b.getFormatDate(c,0);a.searchData.costType.EndDate=b.getFormatDate(c,0);a.searchData.appoint.EndDate=b.getFormatDate(c,0);c.setDate(c.getDate()-6);a.searchData.report.BeginDate=b.getFormatDate(c,0);a.searchData.newPatient.StartDate=b.getFormatDate(c,0);a.searchData.costType.StartDate=b.getFormatDate(c,0);a.searchData.appoint.StartDate=b.getFormatDate(c,0);b.searchPatientFrom(a)};a.changePatientFromTimeType=function(){if(a.PatientFromTimeType!="2"){a.searchData.patientFrom.StartDate=null;a.searchData.patientFrom.EndDate=null;b.searchPatientFrom(a)}};a.searchPatientFrom=function(c){if(c==undefined&&!$.formValidator.pageIsValid("1")){return}b.searchPatientFrom(a)};a.showPatientFromColumnChart=function(){a.showPatientSourcePie=false;if(!a.noPatientSourceData){a.showPatientSourceColumn=true;if(a.patientSourceData!=null){var c=b.createPatientFromSourceOfColumn(a.patientSourceData,a);b.createColumnMultiChart(c)}}};a.showPatientFromPieChart=function(){if(!a.noPatientSourceData){a.showPatientSourcePie=true;if(a.patientSourceData!=null){var c=b.createPatientFromSourceOfPie(a.patientSourceData,a);b.createPieChart(c)}}a.showPatientSourceColumn=false};a.changePatientFromChartType=function(c){if(c==1){a.showPatientFromColumnChart()}else{a.showPatientFromPieChart()}};a.exportPatientFrom=function(){if(!b.isWithOperatePermission("OperateAuth_exportDataStatic")){b.alert("对不起，您没有权限，请联系管理员！");return}b.exportPatientFrom(a)};a.setNewPatientDay=function(){b.setNewPatientStartTime(a,-1)};a.setNewPatientWeek=function(){b.setNewPatientStartTime(a,-7)};a.setNewPatientMonth=function(){b.setNewPatientStartTime(a,-30)};a.searchNewPatient=function(){if(!$.formValidator.pageIsValid("2")){return}b.searchTreats(a)};a.showNewPatientColumnChart=function(){a.showNewPatientLine=false;if(!a.noNewPatientData){a.showNewPatientColumn=true;var c=b.createTreatOfColumn(a.TreatsData,a);b.createColumn3DChart(c)}};a.showNewPatientLineChart=function(){if(!a.noNewPatientData){a.showNewPatientLine=true;var c=b.createTreatOfLine(a.TreatsData,a);b.createLineChart(c)}a.showNewPatientColumn=false};a.changeNewPatientChartType=function(c){if(c==1){a.showNewPatientColumnChart()}else{a.showNewPatientLineChart()}};a.exportTreat=function(){if(!b.isWithOperatePermission("OperateAuth_exportDataStatic")){b.alert("对不起，您没有权限，请联系管理员！");return}b.exportTreat(a)};a.setDoctorCostDay=function(){b.setDoctorCostStartTime(a,-1)};a.setDoctorCostWeek=function(){b.setDoctorCostStartTime(a,-7)};a.setDoctorCostMonth=function(){b.setDoctorCostStartTime(a,-30)};a.switchCostChart=function(c){a.showCostColumn=false;a.showCostPie=false;switch(c){case 1:a.showCostColumn=true;var d=b.createCostForColumn(a.costData,a);b.createColumnMultiChart(d);break;case 2:a.showCostPie=true;var e=b.createCostForPie(a.costData,a);b.createPieChart(e);break;default:break}};a.costTypeSearchClick=function(){if(!$.formValidator.pageIsValid("3")){return}b.searchCostData(a)};a.exportCostType=function(){if(!b.isWithOperatePermission("OperateAuth_exportDataStatic")){b.alert("对不起，您没有权限，请联系管理员！");return}b.exportCostType(a)};a.setAppointDay=function(){b.setAppointStartTime(a,-1)};a.setAppointWeek=function(){b.setAppointStartTime(a,-7)};a.setAppointMonth=function(){b.setAppointStartTime(a,-30)};a.switchAppointChart=function(c){a.showAppointLine=false;a.showAppointPie=false;switch(c){case 1:a.showAppointLine=true;var d=b.createAppointForColumn(a.appointData,a);b.createColumnMultiChart(d);break;case 2:a.showAppointPie=true;var e=b.createAppointForPie(a.appointData,a);b.createPieChart(e);break;default:break}};a.appointSearchClick=function(){if(!$.formValidator.pageIsValid("4")){return}b.searchAppointItemsData(a)};a.exportAppoint=function(){if(!b.isWithOperatePermission("OperateAuth_exportDataStatic")){b.alert("对不起，您没有权限，请联系管理员！");return}b.exportAppoint(a)};a.switchReport=function(d){a.showMonthReport=false;a.showYearReport=false;a.showDoctorReport=false;a.showDailyReport=false;a.searchData.report.DateType=d;a.reportTitle="暂无";switch(d){case 1:var c=new Date(a.searchData.report.DateTime).getFullYear();a.showYearReport=true;a.reportTitle=a.currentUser.Body.Tenant.TenantName+c+"年经营年报报表";break;case 2:var c=new Date(a.searchData.report.DateTime).getFullYear();var e=new Date(a.searchData.report.DateTime).getMonth()+1;a.reportTitle=a.currentUser.Body.Tenant.TenantName+c+"年"+e+"月经营月报报表";a.showMonthReport=true;break;break;case 3:a.showDailyReport=true;var c=new Date(a.searchData.report.DateTime).getFullYear();var e=new Date(a.searchData.report.DateTime).getMonth()+1;a.reportTitle=a.currentUser.Body.Tenant.TenantName+a.searchData.report.DateTime+"日经营日报报表";break;case 4:a.showDoctorReport=true;var c=new Date(a.searchData.report.DateTime).getFullYear();var e=new Date(a.searchData.report.DateTime).getMonth()+1;a.reportTitle=a.currentUser.Body.Tenant.TenantName+a.searchData.report.BeginDate+"至"+a.searchData.report.EndDate+"医生报表";default:break}};a.reportDataSearch=function(){if(a.searchData.report.DateType!=4){b.searchReportData(a)}else{if(!$.formValidator.pageIsValid("5")){return}b.searchEmployeeReportData(a)}};a.convertMonth=function(e){if(e){var d=e.split("-");var c=d[1];switch(parseInt(c)){case 1:return"一月";case 2:return"二月";case 3:return"三月";case 4:return"四月";case 5:return"五月";case 6:return"六月";case 7:return"七月";case 8:return"八月";case 9:return"九月";case 10:return"十月";case 11:return"十一月";case 12:return"十二月";default:return"暂无"}}};a.convertYear=function(c){return c.Year+"/"+c.Month+"/"+c.Day};a.reportExport=function(){if(!b.isWithOperatePermission("OperateAuth_exportDataStatic")){b.alert("对不起，您没有权限，请联系管理员！");return}if(a.searchData.report.DateType!=4){b.exportReport(a)}else{b.exportEmployeeReport(a)}};a.switchTab=function(e,d){$("a.cus_icon").removeClass("cus_icon_active");$("div.cus_icon_unit").removeClass("cus_icon_unit_active");$(d.target).addClass("cus_icon_active");$($(d.target).parent()).addClass("cus_icon_unit_active");switch(e){case 1:var c=1;a.searchPatientFrom(c);break;case 2:b.searchTreats(a);break;case 3:a.costTypeSearchClick();break;case 4:a.appointSearchClick();break;case 5:a.reportDataSearch();break;default:break}};a.switchDateType=function(){switch(a.searchData.report.DateType){case 1:case 2:break;case 3:a.searchData.report.DateTime=new Date().Format("yyyy-MM-dd");break;case 4:break;default:break}};a.initialize()}]);angular.bootstrap($("#main-content"),["DataStaticModule"]);